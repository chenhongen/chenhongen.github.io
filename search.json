[{"title":"【java源码一带一路系列】之HashMap.putAll()","url":"http://rebey.cn/2017/05/07/【java源码一带一路系列】之HashMap.putAll()/","content":"<p>本文以jdk1.8中HashMap.putAll()方法为切入点，分析其中难理解、有价值的源码片段（类似源码查看是ctrl+鼠标左键的过程）。观光线路图：putAll() –&gt; putMapEntries() –&gt; tableSizeFor() –&gt; resize() –&gt; hash() –&gt; putVal()…</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">putAll</span><span class=\"params\">(Map&lt;? extends K, ? extends V&gt; m)</span> </span>&#123;</div><div class=\"line\">    putMapEntries(m, <span class=\"keyword\">true</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">putMapEntries</span><span class=\"params\">(Map&lt;? extends K, ? extends V&gt; m, <span class=\"keyword\">boolean</span> evict)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> s = m.size();</div><div class=\"line\">    <span class=\"keyword\">if</span> (s &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (table == <span class=\"keyword\">null</span>) &#123; <span class=\"comment\">// pre-size</span></div><div class=\"line\">            <span class=\"comment\">// 这里“/loadFactor”得出hash table的capacity，“+1.0”结合下面“&lt;”就懂了。</span></div><div class=\"line\">            <span class=\"keyword\">float</span> ft = ((<span class=\"keyword\">float</span>)s / loadFactor) + <span class=\"number\">1.0F</span>; </div><div class=\"line\">            <span class=\"keyword\">int</span> t = ((ft &lt; (<span class=\"keyword\">float</span>)MAXIMUM_CAPACITY) ?</div><div class=\"line\">                     (<span class=\"keyword\">int</span>)ft : MAXIMUM_CAPACITY);</div><div class=\"line\">            <span class=\"keyword\">if</span> (t &gt; threshold)</div><div class=\"line\">                threshold = tableSizeFor(t);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (s &gt; threshold)</div><div class=\"line\">            resize();</div><div class=\"line\">            </div><div class=\"line\">        <span class=\"comment\">// 笔者疑问：原map加上m后可能需要扩容的判断在putVal中，在此是不是更佳呢？</span></div><div class=\"line\">        <span class=\"keyword\">for</span> (Map.Entry&lt;? extends K, ? extends V&gt; e : m.entrySet()) &#123;</div><div class=\"line\">            K key = e.getKey();</div><div class=\"line\">            V value = e.getValue();</div><div class=\"line\">            putVal(hash(key), key, value, <span class=\"keyword\">false</span>, evict);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<hr>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// 找到大于等于cap的最小的2的幂</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> <span class=\"title\">tableSizeFor</span><span class=\"params\">(<span class=\"keyword\">int</span> cap)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> n = cap - <span class=\"number\">1</span>;</div><div class=\"line\">    n |= n &gt;&gt;&gt; <span class=\"number\">1</span>;</div><div class=\"line\">    n |= n &gt;&gt;&gt; <span class=\"number\">2</span>;</div><div class=\"line\">    n |= n &gt;&gt;&gt; <span class=\"number\">4</span>;</div><div class=\"line\">    n |= n &gt;&gt;&gt; <span class=\"number\">8</span>;</div><div class=\"line\">    n |= n &gt;&gt;&gt; <span class=\"number\">16</span>;</div><div class=\"line\">    <span class=\"keyword\">return</span> (n &lt; <span class=\"number\">0</span>) ? <span class=\"number\">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class=\"number\">1</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>这里的“-1”可以理解为是为了++保证结果值≥原值++。举个栗子，假如cap=8（1000）。计算结果为16(10000)。这显然不是我们想要的最小的2的幂。关于抑或、右移的计算过程，我以size=3为例，可以参考便于理解：<br><img src=\"https://github.com/chenhongen/DemoRun/blob/master/image/tableSizeFor.png?raw=true\" alt=\"image\"></p>\n<p>那么问题来了。为了要遵循“2的幂次方”的套路呢？不仅tableSizeFor如此，连一些参数初始值也遵循着（如DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4）。</p>\n<p>根本意图为了提高效率，为了使用借助以下规律：</p>\n<blockquote>\n<p>取余(%)操作中如果除数是2的幂次方，则等同于与其除数减一的与(&amp;)操作</p>\n</blockquote>\n<p>因此在源码中会看到大量的“(n - 1) &amp; hash”语句，也就是为什么要按“2的幂次方”的套路出牌了。</p>\n<hr>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// hash table扩容至原来2倍，将原table数据重新映射到新table中</span></div><div class=\"line\"><span class=\"keyword\">final</span> Node&lt;K,V&gt;[] resize() &#123;</div><div class=\"line\">    Node&lt;K,V&gt;[] oldTab = table;</div><div class=\"line\">    <span class=\"keyword\">int</span> oldCap = (oldTab == <span class=\"keyword\">null</span>) ? <span class=\"number\">0</span> : oldTab.length;</div><div class=\"line\">    <span class=\"keyword\">int</span> oldThr = threshold;</div><div class=\"line\">    <span class=\"keyword\">int</span> newCap, newThr = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">if</span> (oldCap &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</div><div class=\"line\">            threshold = Integer.MAX_VALUE;</div><div class=\"line\">            <span class=\"keyword\">return</span> oldTab;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((newCap = oldCap &lt;&lt; <span class=\"number\">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</div><div class=\"line\">                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</div><div class=\"line\">            newThr = oldThr &lt;&lt; <span class=\"number\">1</span>; <span class=\"comment\">// double threshold</span></div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (oldThr &gt; <span class=\"number\">0</span>) <span class=\"comment\">// initial capacity was placed in threshold</span></div><div class=\"line\">        newCap = oldThr;</div><div class=\"line\">    <span class=\"keyword\">else</span> &#123;               <span class=\"comment\">// zero initial threshold signifies using defaults</span></div><div class=\"line\">        newCap = DEFAULT_INITIAL_CAPACITY;</div><div class=\"line\">        newThr = (<span class=\"keyword\">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">if</span> (newThr == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">float</span> ft = (<span class=\"keyword\">float</span>)newCap * loadFactor;</div><div class=\"line\">        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class=\"keyword\">float</span>)MAXIMUM_CAPACITY ?</div><div class=\"line\">                  (<span class=\"keyword\">int</span>)ft : Integer.MAX_VALUE);</div><div class=\"line\">    &#125;</div><div class=\"line\">    threshold = newThr;</div><div class=\"line\">    <span class=\"meta\">@SuppressWarnings</span>(&#123;<span class=\"string\">\"rawtypes\"</span>,<span class=\"string\">\"unchecked\"</span>&#125;)</div><div class=\"line\">        Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class=\"keyword\">new</span> Node[newCap];</div><div class=\"line\">    table = newTab;</div><div class=\"line\">    <span class=\"keyword\">if</span> (oldTab != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; oldCap; ++j) &#123;</div><div class=\"line\">            Node&lt;K,V&gt; e;</div><div class=\"line\">            <span class=\"keyword\">if</span> ((e = oldTab[j]) != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">                oldTab[j] = <span class=\"keyword\">null</span>; <span class=\"comment\">// 清空原table</span></div><div class=\"line\">                <span class=\"keyword\">if</span> (e.next == <span class=\"keyword\">null</span>) <span class=\"comment\">// 哈希表只有一个节点，直接赋值</span></div><div class=\"line\">                    newTab[e.hash &amp; (newCap - <span class=\"number\">1</span>)] = e;</div><div class=\"line\">                <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (e <span class=\"keyword\">instanceof</span> TreeNode)</div><div class=\"line\">                    ((TreeNode&lt;K,V&gt;)e).split(<span class=\"keyword\">this</span>, newTab, j, oldCap); <span class=\"comment\">// 红黑树情况</span></div><div class=\"line\">                <span class=\"keyword\">else</span> &#123; <span class=\"comment\">// preserve order</span></div><div class=\"line\">                    Node&lt;K,V&gt; loHead = <span class=\"keyword\">null</span>, loTail = <span class=\"keyword\">null</span>;</div><div class=\"line\">                    Node&lt;K,V&gt; hiHead = <span class=\"keyword\">null</span>, hiTail = <span class=\"keyword\">null</span>;</div><div class=\"line\">                    Node&lt;K,V&gt; next;</div><div class=\"line\">                    do &#123;</div><div class=\"line\">                        next = e.next;</div><div class=\"line\">                        <span class=\"keyword\">if</span> ((e.hash &amp; oldCap) == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                            <span class=\"keyword\">if</span> (loTail == <span class=\"keyword\">null</span>)</div><div class=\"line\">                                loHead = e;</div><div class=\"line\">                            <span class=\"keyword\">else</span></div><div class=\"line\">                                loTail.next = e;</div><div class=\"line\">                            loTail = e;</div><div class=\"line\">                        &#125;</div><div class=\"line\">                        <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                            <span class=\"keyword\">if</span> (hiTail == <span class=\"keyword\">null</span>)</div><div class=\"line\">                                hiHead = e;</div><div class=\"line\">                            <span class=\"keyword\">else</span></div><div class=\"line\">                                hiTail.next = e;</div><div class=\"line\">                            hiTail = e;</div><div class=\"line\">                        &#125;</div><div class=\"line\">                    &#125; <span class=\"keyword\">while</span> ((e = next) != <span class=\"keyword\">null</span>);</div><div class=\"line\">                    <span class=\"keyword\">if</span> (loTail != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">                        loTail.next = <span class=\"keyword\">null</span>;</div><div class=\"line\">                        newTab[j] = loHead;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                    <span class=\"keyword\">if</span> (hiTail != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">                        hiTail.next = <span class=\"keyword\">null</span>;</div><div class=\"line\">                        newTab[j + oldCap] = hiHead;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> newTab;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>hashMap使用链表法避免哈希冲突（相同hash值），当链表长度大于TREEIFY_THRESHOLD（默认为8）时，将链表转换为红黑树，当然小于UNTREEIFY_THRESHOLD（默认为6）时，又会转回链表以达到性能均衡。</p>\n<p>根据“e.hash &amp; oldCap”是否为零将原链表拆分成2个链表，一部分仍保留在原链表中不需要移动，一部分移动到“原索引+oldCap”的新链表中。</p>\n<p>那么问题来了，“e.hash &amp; oldCap”从何而来！？<br>因为扩容前后hash不变，由上文n遵循“2的幂次方”且“index=(n-1)&amp;hash”可知：新的index的决定因素为：++(n-1)二进制最高位对应的hash位上是0还是1++；因此源码作者巧妙的拉关系，以“oldCap等价于newTab的(n-1)的最高位”推出“e.hash &amp; oldCap”！</p>\n<hr>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> <span class=\"title\">hash</span><span class=\"params\">(Object key)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> h;</div><div class=\"line\">    <span class=\"keyword\">return</span> (key == <span class=\"keyword\">null</span>) ? <span class=\"number\">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class=\"number\">16</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<blockquote>\n<p>异或运算：(h = key.hashCode()) ^ (h &gt;&gt;&gt; 16)</p>\n<p>原 来 的 hashCode : 1111 1111 1111 1111 0100 1100 0000 1010<br>移位后的hashCode: 0000 0000 0000 0000 1111 1111 1111 1111<br>进行异或运算 结果：1111 1111 1111 1111 1011 0011 1111 0101</p>\n<p>这样做的好处是，可以将hashcode高位和低位的值进行混合做异或运算，而且混合后，低位的信息中加入了高位的信息，这样高位的信息被变相的保留了下来。掺杂的元素多了，那么生成的hash值的随机性会增大。</p>\n</blockquote>\n<hr>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> V <span class=\"title\">putVal</span><span class=\"params\">(<span class=\"keyword\">int</span> hash, K key, V value, <span class=\"keyword\">boolean</span> onlyIfAbsent,</span></span></div><div class=\"line\">               <span class=\"keyword\">boolean</span> evict) &#123;</div><div class=\"line\">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class=\"keyword\">int</span> n, i;</div><div class=\"line\">    <span class=\"keyword\">if</span> ((tab = table) == <span class=\"keyword\">null</span> || (n = tab.length) == <span class=\"number\">0</span>)</div><div class=\"line\">        n = (tab = resize()).length;</div><div class=\"line\">    <span class=\"keyword\">if</span> ((p = tab[i = (n - <span class=\"number\">1</span>) &amp; hash]) == <span class=\"keyword\">null</span>)</div><div class=\"line\">        tab[i] = newNode(hash, key, value, <span class=\"keyword\">null</span>);</div><div class=\"line\">    <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        Node&lt;K,V&gt; e; K k;</div><div class=\"line\">        <span class=\"keyword\">if</span> (p.hash == hash &amp;&amp;</div><div class=\"line\">            ((k = p.key) == key || (key != <span class=\"keyword\">null</span> &amp;&amp; key.equals(k))))</div><div class=\"line\">            e = p;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (p <span class=\"keyword\">instanceof</span> TreeNode)</div><div class=\"line\">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class=\"keyword\">this</span>, tab, hash, key, value);</div><div class=\"line\">        <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> binCount = <span class=\"number\">0</span>; ; ++binCount) &#123;</div><div class=\"line\">                <span class=\"keyword\">if</span> ((e = p.next) == <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">                    p.next = newNode(hash, key, value, <span class=\"keyword\">null</span>);</div><div class=\"line\">                    <span class=\"keyword\">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class=\"number\">1</span>) <span class=\"comment\">// -1 for 1st</span></div><div class=\"line\">                        treeifyBin(tab, hash);</div><div class=\"line\">                    <span class=\"keyword\">break</span>;</div><div class=\"line\">                &#125;</div><div class=\"line\">                <span class=\"keyword\">if</span> (e.hash == hash &amp;&amp;</div><div class=\"line\">                    ((k = e.key) == key || (key != <span class=\"keyword\">null</span> &amp;&amp; key.equals(k))))</div><div class=\"line\">                    <span class=\"keyword\">break</span>;</div><div class=\"line\">                p = e;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">if</span> (e != <span class=\"keyword\">null</span>) &#123; <span class=\"comment\">// existing mapping for key</span></div><div class=\"line\">            V oldValue = e.value;</div><div class=\"line\">            <span class=\"keyword\">if</span> (!onlyIfAbsent || oldValue == <span class=\"keyword\">null</span>)</div><div class=\"line\">                e.value = value;</div><div class=\"line\">            afterNodeAccess(e);</div><div class=\"line\">            <span class=\"keyword\">return</span> oldValue;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    ++modCount;</div><div class=\"line\">    <span class=\"keyword\">if</span> (++size &gt; threshold)</div><div class=\"line\">        resize();</div><div class=\"line\">    afterNodeInsertion(evict);</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>相对清晰，留坑后填，江湖再见</p>\n<hr>\n<p><strong>源码中出现的全局变量：</strong></p>\n<p><em><a href=\"http://www.cnblogs.com/szlbm/p/5504166.html\" target=\"_blank\" rel=\"external\">transient</a> Node<k,v>[] table;</k,v></em>  哈希表,初始化长度length(默认值是16)</p>\n<p><em>final float loadFactor;</em>  负载因子（默认0.75）,表示table的填满程度。</p>\n<p><em>static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;</em>  最大容量</p>\n<p><em>int threshold;</em>  阈值 = table.length * loadFactor</p>\n<p>…</p>\n<hr>\n<p><strong>参考文献：</strong></p>\n<ol>\n<li><a href=\"http://blog.csdn.net/fan2012huan/article/details/51097331\" target=\"_blank\" rel=\"external\">HashMap源码注解 之 静态工具方法hash()、tableSizeFor()（四）</a>；201604</li>\n<li><a href=\"http://lishuo.me/2017/04/16/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8BHashMap/?utm_source=tuicool&amp;utm_medium=referral\" target=\"_blank\" rel=\"external\">源码分析之HashMap</a>；201704</li>\n<li><a href=\"http://blog.csdn.net/u010176014/article/details/52213395\" target=\"_blank\" rel=\"external\">【集合详解】HashMap源码解析</a>；201608</li>\n<li><a href=\"http://note.youdao.com/share/?spm=5176.100239.0.0.Kai02P&amp;id=07710dc47ce4a8812ddc0261cb659f2e&amp;type=note#/\" target=\"_blank\" rel=\"external\">HashMap源码分析（jdk1.8）</a>;201604</li>\n</ol>\n"},{"title":"WebVR端午龙头记","url":"http://rebey.cn/2017/04/29/AFrame端午龙头记/","content":"<ul>\n<li><p><strong>效果展示</strong>：</p>\n<p>  ☞ <a href=\"http://rebey.oschina.io/aframe/\" target=\"_blank\" rel=\"external\">点我打开新世界</a></p>\n<p>  <img src=\"https://sfault-image.b0.upaiyun.com/435/217/435217286-5904581ecba5f_articlex\" alt=\"图片描述\"></p>\n<ul>\n<li><p><strong>相关技术</strong>：</p>\n<p>☞ <em>aframe.js</em>： Mozilla 开源的网页虚拟现实体验( WebVR )框架；</p>\n<p>☞ <em>MagicaVoxel</em>： @ephtracy开发的体素编辑神器；</p>\n</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><strong>代码实现</strong>：</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\">html:</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/aframe.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"js/aframe-extras.loaders.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\">  </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a-scene</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">a-assets</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">a-asset-item</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myModelObj\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"che.obj\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a-asset-item</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">a-asset-item</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myModelMtl\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"che.mtl\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a-asset-item</span>&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- &lt;a-asset-item id=\"myPlyModel\" src=\"che.ply\"&gt;&lt;/a-asset-item&gt; --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">id</span>=<span class=\"string\">\"skyTexture\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"image/sechelt.jpg\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">a-assets</span>&gt;</span></div><div class=\"line\">  </div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">a-entity</span> <span class=\"attr\">position</span>=<span class=\"string\">\"0 1.2 -5\"</span> <span class=\"attr\">scale</span>=<span class=\"string\">\"0.035 0.035 0.035\"</span> <span class=\"attr\">rotation</span>=<span class=\"string\">\"-10 -150 -15\"</span> <span class=\"attr\">obj-model</span>=<span class=\"string\">\"obj: #myModelObj; mtl: #myModelMtl\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">a-animation</span> <span class=\"attr\">attribute</span>=<span class=\"string\">\"position\"</span> <span class=\"attr\">to</span>=<span class=\"string\">\"0 1.4 -5\"</span> <span class=\"attr\">direction</span>=<span class=\"string\">\"alternate\"</span> <span class=\"attr\">dur</span>=<span class=\"string\">\"2000\"</span> <span class=\"attr\">repeat</span>=<span class=\"string\">\"indefinite\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a-animation</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">a-animation</span> <span class=\"attr\">attribute</span>=<span class=\"string\">\"rotation\"</span> <span class=\"attr\">begin</span>=<span class=\"string\">\"click\"</span> <span class=\"attr\">dur</span>=<span class=\"string\">\"7200\"</span> <span class=\"attr\">to</span>=<span class=\"string\">\"-10 570 -15\"</span> &gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a-animation</span>&gt;</span></div><div class=\"line\">  \t</div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">a-entity</span>&gt;</span></div><div class=\"line\">  <span class=\"comment\">&lt;!-- &lt;a-entity ply-model=\"src: #myPlyModel\" position=\"0 1 -1\" scale=\"0.01 0.01 0.01\" rotation=\"-90 0 0\"&gt;&lt;/a-entity&gt; --&gt;</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">a-sky</span> <span class=\"attr\">src</span>=<span class=\"string\">\"#skyTexture\"</span> &gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a-sky</span>&gt;</span></div><div class=\"line\">  </div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">a-text</span> <span class=\"attr\">value</span>=<span class=\"string\">\"rebey.cn 端午节快乐！\"</span> <span class=\"attr\">color</span>=<span class=\"string\">\"#CCC\"</span> </span></div><div class=\"line\">    <span class=\"attr\">position</span>=<span class=\"string\">\"-0.9 0.2 -3\"</span> <span class=\"attr\">scale</span>=<span class=\"string\">\"2 2 2\"</span>&gt;<span class=\"tag\">&lt;/<span class=\"name\">a-text</span>&gt;</span></div><div class=\"line\">  </div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">a-camera</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">a-cursor</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a-cursor</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">a-camera</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">a-scene</span>&gt;</span></div></pre></td></tr></table></figure>\n<ul>\n<li><p><strong>代码分析</strong>：</p>\n<p> 由aframe全权负责搭建3d全景，由 <em>entity-龙头、sky-天空环境、text-文字、camera-模拟镜头焦点、assert-存放定义对象（通过id引用）</em>构成。更多aframe知识点参考官网<a href=\"https://aframe.io/docs/0.5.0/guides/building-with-magicavoxel.html\" target=\"_blank\" rel=\"external\">aframe.io</a>。最花时间的就是使用MagicaVoxel画的龙头，画了我两天近十几个小时。最终和大家分享成果，庆祝一年一度的端午节。</p>\n</li>\n<li><p><strong>写在最后</strong>：</p>\n<p> 最重要的往往在最后。细心的你发现了吗？在源码中a-text的值明明写了中文却没有显示。是的，aframe用的字体不支持伟大的汉字，前端大神可以尝试一下更改aframe引用的字体。</p>\n<p> 还有一点重要的是，引用aframe.js后必须运行在服务器端，否则可能出现浏览器提示跨域冲突的问题，可以将代码置于nodejs或者tomcat等服务器下运行。</p>\n<p> 此外，aframe支持MagicaVoxel导出的两种方式.PLY (with Baked Shadows)与.OBJ。当你选择的是OBJ时请注意，导出的是3个文件（.obj/.png/.mtl）缺一不可。</p>\n</li>\n</ul>\n<ul>\n<li><p><strong>关于作者</strong>：</p>\n<p> <a href=\"http://rebey.cn\">rebey.cn</a>：个人博客-沉迷前端美色的java工程师，有工作机会欢迎联系。</p>\n</li>\n</ul>\n"},{"title":"SSM架构问题记录之配置篇","url":"http://rebey.cn/2017/02/19/SSM架构问题记录之配置篇/","content":"<ul>\n<li><p><strong>概要</strong></p>\n<p>  习惯了使用别人的框架，自己动手时碰到的一些问题。</p>\n<p>  工具：maven+spring+mybatis+oracle等。</p>\n</li>\n<li><p><strong>问题01</strong></p>\n<p>  使用MyBatis Generator自动生成工具生成代码，使用junit测试insert一条记录。（由于<a href=\"http://www.cnblogs.com/panie2015/p/5807683.html\" target=\"_blank\" rel=\"external\">oracle主键自增需要依赖序列</a>，这里采用手动赋值测试。）</p>\n<p>  <strong>报错</strong>：==<em>…无效的列类型: getBigDecimal not implemented for class oracle.jdbc.driver.T4CRowidAcces…</em>==；</p>\n</li>\n<li><p><strong>解决01</strong></p>\n<p>  最主要的原因，是我在mybatis-config.xml中配置了“<setting name=\"useGeneratedKeys\" value=\"true\">”而oracle并不支持所以报错；<br>  此外值得一提的是，Generator在生成PO对象时会更加++NUMBER类型的长度++对应java数据类型。如下：</setting></p>\n<p>  长度 | 类型<br>  —|—<br>  1~4 | Short<br>  5~9 | Integer<br>  10~18 | Long<br>  18+（或不写） | BigDecimal</p>\n</li>\n<li><p><strong>挥别亲朋，漂泊异乡在这几平米的空间里就是写梦想，没有时间浪了。待续…</strong></p>\n</li>\n</ul>\n"},{"title":"js：对象-属性-set/get","url":"http://rebey.cn/2016/12/31/js中的set与get/","content":"<p><strong>碎语</strong>：</p>\n<p>&emsp;&emsp;js有<em>对象-属性</em>这早已耳熟能详，直到偶然看到某开源js源码才发现，同java一样，它也有对应的<em>set/get方法</em>。</p>\n<p><strong>demo</strong>：<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> che = &#123;</div><div class=\"line\">\t_wheels: <span class=\"number\">4</span>,</div><div class=\"line\">\tget wheels() &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">this</span>._wheels;</div><div class=\"line\">\t&#125;,</div><div class=\"line\">\tset wheels(value) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span>(value &lt; <span class=\"number\">1</span>) &#123;</div><div class=\"line\">\t\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">'give me a wheel at least,please!'</span>);</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">this</span>._wheels = value;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">\"che.wheels: \"</span>+che.wheels);</div><div class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">\"che._wheels: \"</span>+che._wheels);</div><div class=\"line\"></div><div class=\"line\">che.wheels = <span class=\"number\">2</span>;</div><div class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">\"che.wheels: \"</span>+che.wheels);</div><div class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">\"che._wheels: \"</span>+che._wheels);</div><div class=\"line\"></div><div class=\"line\">che.wheels = <span class=\"number\">0</span>;</div><div class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">\"che.wheels: \"</span>+che.wheels);</div><div class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">\"che._wheels: \"</span>+che._wheels);</div></pre></td></tr></table></figure></p>\n<p><strong>兼容</strong>：这种写法并==不支持IE8==，替代方法如下;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> che2 = &#123;</div><div class=\"line\">\t_wheels: <span class=\"number\">4</span></div><div class=\"line\">&#125;;</div><div class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(che2, <span class=\"string\">\"wheels\"</span>, &#123;</div><div class=\"line\">\tget: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">this</span>._wheels;</div><div class=\"line\">\t&#125;,</div><div class=\"line\">\tset: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span>(value &lt; <span class=\"number\">1</span>) &#123;</div><div class=\"line\">\t\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">'give me a wheel at least,please!'</span>);</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">this</span>._wheels = value;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<p><strong>补充</strong>：</p>\n<p>传说中的标准写法（不代表常用）<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Field</span>(<span class=\"params\">val</span>)</span>&#123;  </div><div class=\"line\">    <span class=\"keyword\">this</span>.value = val;  </div><div class=\"line\">&#125; </div><div class=\"line\"></div><div class=\"line\">Field.prototype = &#123;  </div><div class=\"line\">    get value()&#123;  </div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>._value;  </div><div class=\"line\">    &#125;,  </div><div class=\"line\">    set value(val)&#123;  </div><div class=\"line\">        <span class=\"keyword\">this</span>._value = val;  </div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> field = <span class=\"keyword\">new</span> Field(<span class=\"string\">\"che\"</span>);</div><div class=\"line\"><span class=\"built_in\">console</span>.log(field.value);</div><div class=\"line\"></div><div class=\"line\">field.value = <span class=\"string\">\"che2\"</span>;</div><div class=\"line\"><span class=\"built_in\">console</span>.log(field.value);</div></pre></td></tr></table></figure></p>\n<p>常用写法（外界无法修改默认值）<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> che3 = &#123;</div><div class=\"line\">\tget wheels() &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">4</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">\"che3.wheels: \"</span> + che3.wheels);</div><div class=\"line\"></div><div class=\"line\">che3.wheels = <span class=\"number\">2</span>;</div><div class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">\"che3.wheels: \"</span> + che3.wheels);</div></pre></td></tr></table></figure></p>\n<p><del>最后祝各位程序员，新年吉祥。早！日！脱！单</del>！</p>\n<p><strong>参考</strong>：<a href=\"http://www.cnblogs.com/lhb25/archive/2010/09/19/1830724.html\" target=\"_blank\" rel=\"external\">网络之美：JavaScript中Get和Set访问器的实现 </a></p>\n"},{"title":"CheBus2Mail 实时公交信息（邮件版）踩坑记","url":"http://rebey.cn/2016/10/23/CheBus2Mail 实时公交信息（邮件版）踩坑记/","content":"<ul>\n<li><p><strong>前景</strong></p>\n<p>  在寒冬，于北京。错过一辆晚高峰的公交就好比全世界从你身边路过。</p>\n<p>  需求是第一生产力，公交集团推出了查询实时公交的微信公众号，无奈不准确且不稳定，用户体验差。随后某度地图与其合作将此功能结合到了自己的产品中，公交实时定位基本准确。查询总共分三步：<del>①把冰箱门打开</del> <em>①输入公交车次号;②选择公交开往方向；③选择乘坐站点</em>。查询结果会告诉你，离你最近的三辆公交距离你还有几站。</p>\n<p>  那么问题来了，我每天就是要从公司坐同一趟车回家，车次、方向、站点、时间基本固定。根据查询结果的距离站点数，决定我出门候车时间。可以极大降低因候车时间，从而减少雾霾吸收量。然而，不愉快的事我每天需要抽出时间打开它那沉重的APP，输入相同的数字，点击重复的操作才能得到我想要的数据。这么一来，需求很明确了，我们需要一个定时推送实时公交信息的功能的喔~</p>\n</li>\n<li><p><strong>思路</strong></p>\n</li>\n</ul>\n<ol>\n<li>爬虫：nodejs也好、python也好、java也好。能爬到数据的就是好爬虫；</li>\n<li>解析：抓取后数据处理，提取关键信息；</li>\n<li>推送：微信也好、QQ也好、邮件也好。不需要认证审核、消息数量无限制、开发代价小，那么首选就是邮件了。</li>\n</ol>\n<ul>\n<li><p><strong>难点</strong></p>\n<p>门神：起初由于最近刚自学了nodejs，看到它可以写爬虫，就尝试用它来抓取网页数据。然而公交集团的php网站做了类似cookie校验的措施。ajax请求无情的抛回来“timeout”。也尝试过模仿请求头来请求，也吃了闭门羹。这种防爬虫的措施，让我不得不放弃几行代码就能实现爬虫的nodejs，而改用主要用于自动化测试的java ==selenium==。</p>\n<p>版本：selenium需要浏览器驱动（如：chromedriver.exe）的辅助。新版本的浏览器可能出现不支持的情况！如果你在本机运行selenium启动浏览器没问题，在服务器运行报错。jar包引入等都没问题情况下，查询浏览器版本吧。</p>\n<p>定时：==ScheduledExecutorService==实现定时效果。</p>\n<p>运行：在本机，将java project打成runnable jar。win7下直接双击可直接执行，而放到window server 2008服务器上却执行不了，甚是郁闷。研究jre/jvm配置后无果，变通采用==exe4j==工具，将jar打成exe可执行文件。顺带支持自定义logo。</p>\n<p><img src=\"https://github.com/chenhongen/imgStorage/raw/master/20161023-cbm.png\" alt=\"image\"></p>\n</li>\n<li><p><strong>效果</strong></p>\n<p>每天下班时间邮箱收到抓取后的公交信息邮件。</p>\n<p><img src=\"https://github.com/chenhongen/imgStorage/raw/master/20161023-result.jpg\" alt=\"image\"></p>\n</li>\n<li><p><strong>源码</strong></p>\n<p>保护水表，暂不开源。</p>\n</li>\n</ul>\n"},{"title":"js仿Excel公式应用-ruleJS","url":"http://rebey.cn/2016/09/25/js仿Excel公式应用-ruleJS/","content":"<ul>\n<li><p><strong>概要</strong></p>\n<p>  这是一个基于ruleJS的应用小Demo，体现<em>网页表格等输入公式（类似Excel）并自动计算结果</em>的效果；适用IE9及以上主流浏览器；demo根据<a href=\"https://github.com/chenhongen/ruleJS\" target=\"_blank\" rel=\"external\">handsontable github</a>上源码改编。</p>\n</li>\n<li><p><strong>难点</strong></p>\n<p>  ruleJS取值定位类似Excel，默认使用了横轴英文字母(A、B、C…),纵轴数字（1,、2、3…）来定位值；如，id值为“C1”即表示第3列第1行元素;此时当网页同时存在多个表格时，需要考虑id重复的隐患，本例使用了iframe来回避这个问题；</p>\n<p>  尝试兼容IE8做了些修改，替换了源码中使用的一些IE8不支持的函数，诸如：querySelectorAll、Array.indexOf、Array.filter、Array.forEach、getElementsByClassName等；最后还是因为ie8没有HTMLElement兼容失败，暂时抛弃小八（T T）；</p>\n<p>  handsontable贴出的介绍函数链接已失效，可参考Excel相关函数定义规范来使用（或者看js源码–）；</p>\n</li>\n<li><p><strong>链接</strong><br>  演示地址：<a href=\"https://chenhongen.github.io/ruleJS4Excel\" target=\"_blank\" rel=\"external\">点我</a>；<br>  demo源码：<a href=\"https://github.com/chenhongen/ruleJS4Excel\" target=\"_blank\" rel=\"external\">github传送门</a>；</p>\n</li>\n<li><p><strong>源码分析</strong></p>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">☞ ruleJS.all.full.js片段：</div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * form elements, which can be parsed</div><div class=\"line\">     * @type &#123;string[]&#125;</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"comment\">//var formElements = ['input[type=text]', '[data-formula]'];</span></div><div class=\"line\">    <span class=\"comment\">//定义需要转换为公式的选择器</span></div><div class=\"line\">    <span class=\"keyword\">var</span> formElements = [<span class=\"string\">'input[class=rj-formula]'</span>, <span class=\"string\">'[data-formula]'</span>];</div></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">☞ jsp片段：</div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"A3\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"7\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"rj-formula\"</span>&gt;</span></div><div class=\"line\">    ...</div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">id</span>=<span class=\"string\">\"K1\"</span> <span class=\"attr\">data-formula</span>=<span class=\"string\">\"SUM(A1:C3,A1)\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"rj-formula\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></div></pre></td></tr></table></figure>"},{"title":"querySelector/querySelectorAll","url":"http://rebey.cn/2016/09/21/querySelector与querySelectorAll/","content":"<p><strong>格式</strong>：</p>\n<p><em>[1].querySelector([2]);</em></p>\n<p><em>[1].querySelectorAll([2]);</em></p>\n<p>[1]Document/Element;</p>\n<p>[2]CSS 选择器: id, 类, 类型, 属性, 属性值等;多个时querySelectorAll(“①,②，…”)或querySelectorAll([“①”,”②”，…]);</p>\n<p><strong>说明</strong>：主要作用为CSS选择器；querySelector返回第一个匹配元素,匹配不到返回null；querySelectorAll返回所有匹配元素集合，匹配不到返回NodeList[]；</p>\n<p>这里着重说明querySelectorAll，其返回值为NodeList。<br>NodeList是静态的，主要有length与item两个属性；常把NodeList转为数组使用：Array.prototype.slice.call(div_list);</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"> <span class=\"comment\">// 体现静态</span></div><div class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"body\"</span>).querySelectorAll(<span class=\"string\">\"div\"</span>);</div><div class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"built_in\">document</span>.getElementsByTagName(<span class=\"string\">\"div\"</span>);</div><div class=\"line\"><span class=\"keyword\">var</span> oDiv = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"div\"</span>);</div><div class=\"line\"><span class=\"built_in\">document</span>.body.appendChild(oDiv);</div><div class=\"line\">alert(<span class=\"string\">\"querySelectorAll:\"</span>+a.length+<span class=\"string\">\"getElementsByTagName:\"</span>+b.length);</div><div class=\"line\"><span class=\"comment\">// 结果：querySelectorAll:3 getElementsByTagName:4</span></div></pre></td></tr></table></figure>\n<p>在IE8下返回类型为StaticNodeList，StaticNodeList只有length属性，使用时小心。</p>\n<p><strong>兼容</strong>：主流浏览器基本支持，特别注意的是，<a href=\"http://caniuse.com/#search=querySelector\" target=\"_blank\" rel=\"external\">IE8只支持CSS2.1和一小部分CSS3</a></p>\n<p><strong>引发</strong>：<br>在handsontable上看到用ruleJS实现了类似Excel的单元格公式计算。download了源码想研究下，结果发现IE8不好使，一查源头就到了querySelectorAll上。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// ruleJS src</span></div><div class=\"line\"><span class=\"keyword\">var</span> formElements = [<span class=\"string\">'input[type=text]'</span>, <span class=\"string\">'[data-formula]'</span>];</div><div class=\"line\">[].slice.call($totalElements).forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$item</span>) </span>&#123;</div><div class=\"line\">    registerElementInMatrix($item);</div><div class=\"line\">    registerElementEvents($item);</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<p><strong>参考</strong>：<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Document/querySelector\" target=\"_blank\" rel=\"external\">MDN Web API</a></p>\n"},{"title":"H5+CSS3 罗小黑动画","url":"http://rebey.cn/2016/09/03/H5+CSS3 罗小黑动画/","content":"<ul>\n<li><p><strong>概要</strong></p>\n<p>  css3-animation-steps()函数 + Sprite（雪碧图）让萌萌的小黑动起来；<br>  html5-canvas 画一个逗喵神器。</p>\n</li>\n<li><p><strong>难点</strong></p>\n<p>  实现纯canvas绘制以指定坐标为原点旋转指定角度的椭圆；<br>  椭圆与曲线活动轨迹磨合调整，多canvas整合；</p>\n</li>\n<li><p><strong>链接</strong><br>  关于本人使用steps()灵感来源于<a href=\"https://jdc.jd.com/archives/1801\" target=\"_blank\" rel=\"external\">京东618</a>的这篇技术贴，里面大致阐述了steps原理，网上还有更透彻的讲解，感兴趣的童鞋可以查阅;<br>  演示地址：<a href=\"https://chenhongen.github.io/h5css3-LUOXIAOHEI/\" target=\"_blank\" rel=\"external\">点我</a>；<br>  demo源码：<a href=\"https://github.com/chenhongen/h5css3-LUOXIAOHEI\" target=\"_blank\" rel=\"external\">github传送门</a>；</p>\n</li>\n<li><p><strong>主要源码</strong></p>\n</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\">☞ <span class=\"selector-tag\">css</span>片段：</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.xiaohei</span> &#123;</div><div class=\"line\">\t<span class=\"attribute\">width</span>: <span class=\"number\">350px</span>;</div><div class=\"line\">\t<span class=\"attribute\">height</span>: <span class=\"number\">200px</span>;</div><div class=\"line\">\t<span class=\"attribute\">background</span>: <span class=\"built_in\">url</span>(xx.png) no-repeat <span class=\"number\">0</span> <span class=\"number\">0</span>;</div><div class=\"line\">\t<span class=\"attribute\">animation</span>: toleft <span class=\"number\">2s</span> infinite <span class=\"built_in\">steps</span>(11, end);</div><div class=\"line\">\t<span class=\"attribute\">-moz-animation</span>: toleft <span class=\"number\">1.5s</span> infinite <span class=\"built_in\">steps</span>(11);</div><div class=\"line\">\t<span class=\"attribute\">-webkit-animation</span>: toleft <span class=\"number\">2s</span> infinite <span class=\"built_in\">steps</span>(11);</div><div class=\"line\">\t<span class=\"attribute\">z-index</span>: -<span class=\"number\">1</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">@<span class=\"keyword\">keyframes</span> toleft &#123;</div><div class=\"line\">\t<span class=\"comment\">/*0% &#123;background-position:0;&#125;*/</span></div><div class=\"line\">\t100%&#123; <span class=\"attribute\">background-position</span>: -<span class=\"number\">4180px</span> <span class=\"number\">0px</span>;&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">@-<span class=\"keyword\">webkit</span>-<span class=\"keyword\">keyframes</span> toleft &#123;</div><div class=\"line\">\t100%&#123; <span class=\"attribute\">background-position</span>: -<span class=\"number\">4180px</span> <span class=\"number\">0px</span>;&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">@-<span class=\"keyword\">moz</span>-<span class=\"keyword\">keyframes</span> toleft &#123;</div><div class=\"line\">\t100% &#123;<span class=\"attribute\">background-position</span>: -<span class=\"number\">4180px</span> <span class=\"number\">0</span>;&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div></pre></td><td class=\"code\"><pre><div class=\"line\">☞ js片段：</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> h = <span class=\"number\">30</span>, <span class=\"comment\">// 高度（y轴坐标）</span></div><div class=\"line\">\tarr = [<span class=\"number\">5</span>,<span class=\"number\">7</span>,<span class=\"number\">8</span>,<span class=\"number\">9</span>,<span class=\"number\">10</span>,<span class=\"number\">20</span>,<span class=\"number\">30</span>,<span class=\"number\">50</span>,<span class=\"number\">1</span>,<span class=\"number\">-50</span>,<span class=\"number\">-30</span>,<span class=\"number\">-20</span>,<span class=\"number\">-10</span>,<span class=\"number\">-8</span>,<span class=\"number\">-6</span>,<span class=\"number\">-5</span>,<span class=\"number\">-3</span>], <span class=\"comment\">// 草头旋转角度数组</span></div><div class=\"line\">\t<span class=\"comment\">//arrDown = [-6,-7,-8,-9,-10,-20,-30,-50,1,50,30,20,10,8,6,5,4], // 草头下至上旋转角度数组</span></div><div class=\"line\">\ti = <span class=\"number\">0</span>, <span class=\"comment\">// 数组下标</span></div><div class=\"line\">\tflag = <span class=\"literal\">true</span>, <span class=\"comment\">// 切换标识</span></div><div class=\"line\">\ttimer = <span class=\"literal\">null</span>; <span class=\"comment\">// 定时器</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// 绘制椭圆（草头）</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">drawOval</span>(<span class=\"params\">ctx, h, neg</span>) </span>&#123;</div><div class=\"line\">\tctx.clearRect(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">200</span>,<span class=\"number\">200</span>);<span class=\"comment\">//清除画布上的指定区域</span></div><div class=\"line\">\tctx.beginPath();</div><div class=\"line\">\t</div><div class=\"line\">\tctx.save();</div><div class=\"line\">\tctx.translate(<span class=\"number\">16</span>,(h-i/<span class=\"number\">8</span>)+<span class=\"number\">8</span>); <span class=\"comment\">// 垂直变化</span></div><div class=\"line\">\tctx.rotate(<span class=\"built_in\">Math</span>.PI/arr[i]*neg); <span class=\"comment\">// 旋转角度</span></div><div class=\"line\">\tctx.scale(<span class=\"number\">1</span>,<span class=\"number\">1</span>/<span class=\"number\">2</span>); <span class=\"comment\">// 绘制椭圆</span></div><div class=\"line\">\tctx.arc(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">15</span>,<span class=\"number\">0</span>,<span class=\"built_in\">Math</span>.PI*<span class=\"number\">2</span>);</div><div class=\"line\">\tctx.fill(); <span class=\"comment\">// 填充</span></div><div class=\"line\">\tctx.stroke();</div><div class=\"line\">\tctx.restore();</div><div class=\"line\"></div><div class=\"line\">\ti++; <span class=\"comment\">// 数组遍历</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// 贝塞尔曲线（草杆）绘制</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">drawLine</span>(<span class=\"params\">h</span>) </span>&#123;</div><div class=\"line\">\tcontext.clearRect(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">200</span>,<span class=\"number\">200</span>);<span class=\"comment\">//清除画布上的指定区域</span></div><div class=\"line\">\tcontext.beginPath();</div><div class=\"line\">\tcontext.moveTo(<span class=\"number\">20</span>,h+<span class=\"number\">5</span>); <span class=\"comment\">// 起点</span></div><div class=\"line\">\tcontext.bezierCurveTo(<span class=\"number\">80</span>,<span class=\"number\">100</span>,<span class=\"number\">120</span>,<span class=\"number\">100</span>,<span class=\"number\">200</span>,<span class=\"number\">100</span>); <span class=\"comment\">// </span></div><div class=\"line\">\tcontext.stroke();</div><div class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// 绘制函数</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">load</span>(<span class=\"params\">v</span>) </span>&#123;</div><div class=\"line\">\tclearInterval(timer);</div><div class=\"line\">\ttimer = setInterval(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span>(h===<span class=\"number\">150</span>) &#123;flag = <span class=\"literal\">false</span>; i = <span class=\"number\">0</span>;&#125; <span class=\"comment\">// 切换条件</span></div><div class=\"line\">\t\t<span class=\"keyword\">if</span>(h===<span class=\"number\">30</span>) &#123;flag = <span class=\"literal\">true</span>; i = <span class=\"number\">0</span>;&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">if</span>(flag) &#123;</div><div class=\"line\">\t\t\th = ++h;</div><div class=\"line\">\t\t\t(h%<span class=\"number\">8</span> == <span class=\"number\">0</span>) &amp;&amp; drawOval(context1, h, <span class=\"number\">1</span>);</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">\t\t\th = --h;</div><div class=\"line\">\t\t\t(h%<span class=\"number\">8</span> == <span class=\"number\">0</span>) &amp;&amp; drawOval(context1, h, <span class=\"number\">-1</span>);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tdrawLine(h);</div><div class=\"line\"></div><div class=\"line\">\t\tcontext.drawImage(canvas1,<span class=\"number\">0</span>,<span class=\"number\">0</span>); <span class=\"comment\">// 合并多画布</span></div><div class=\"line\">\t&#125;, v);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n"},{"title":"Json的转换与传递","url":"http://rebey.cn/2016/04/16/Json的转换与传递/","content":"<ul>\n<li><p><strong>概要</strong></p>\n<p>  项目中常用的json形式数据在前后台实现string与object对象等各种互转相关知识点整理。</p>\n</li>\n<li><p><strong>前端：Form Data–&gt;Json Object–&gt;Json String:</strong></p>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">☞ jsp片段：</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">\"\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"jsonForm\"</span>&gt;</span></div><div class=\"line\">    cd：<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"goodsCd\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"20150904\"</span> /&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>/&gt;</span></div><div class=\"line\">    name：<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"goodsName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"che\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></div></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\">☞ js片段：</div><div class=\"line\"><span class=\"comment\">//具有name、value属性，序列化成一个Object对象</span></div><div class=\"line\">$.fn.serializeObject = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">   <span class=\"keyword\">var</span> obj = &#123;&#125;;</div><div class=\"line\">   <span class=\"keyword\">var</span> arr = <span class=\"keyword\">this</span>.serializeArray();</div><div class=\"line\">   $.each(arr, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">       <span class=\"keyword\">if</span> (obj[<span class=\"keyword\">this</span>.name]) &#123;</div><div class=\"line\">           <span class=\"keyword\">if</span> (!obj[<span class=\"keyword\">this</span>.name].push) &#123;</div><div class=\"line\">               obj[<span class=\"keyword\">this</span>.name] = [ obj[<span class=\"keyword\">this</span>.name] ];</div><div class=\"line\">           &#125;</div><div class=\"line\">           obj[<span class=\"keyword\">this</span>.name].push(<span class=\"keyword\">this</span>.value || <span class=\"string\">''</span>);</div><div class=\"line\">       &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">           obj[<span class=\"keyword\">this</span>.name] = <span class=\"keyword\">this</span>.value || <span class=\"string\">''</span>;</div><div class=\"line\">       &#125;</div><div class=\"line\">   &#125;);</div><div class=\"line\">   <span class=\"keyword\">return</span> obj;</div><div class=\"line\">&#125;;</div><div class=\"line\"><span class=\"keyword\">var</span> jsonForm = $(<span class=\"string\">\"#jsonForm\"</span>);</div><div class=\"line\"><span class=\"comment\">// json对象转json字符串</span></div><div class=\"line\"><span class=\"keyword\">var</span> jsonStr = <span class=\"built_in\">JSON</span>.stringify(jsonForm.serializeObject());</div><div class=\"line\">alert(jsonStr);</div></pre></td></tr></table></figure>\n<ul>\n<li><strong>前端：Json String–&gt;Json Object：</strong></li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">☞ js片段：</div><div class=\"line\">jQuery.parseJSON(jsonStr));</div></pre></td></tr></table></figure>\n<ul>\n<li><strong>前后端：Json Object–&gt;JavaBean：</strong></li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div></pre></td><td class=\"code\"><pre><div class=\"line\">☞ js片段：</div><div class=\"line\"><span class=\"comment\">// rb须与后台实体变量名称同名</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getRbJson</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> rbJson = &#123;&#125;;</div><div class=\"line\">    </div><div class=\"line\">    rbJson[<span class=\"string\">\"rb.goodsType\"</span>] = <span class=\"string\">\"a\"</span>;</div><div class=\"line\">    rbJson[<span class=\"string\">\"rb.goodsCd\"</span>] = <span class=\"string\">\"b\"</span>;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">return</span> rbJson;</div><div class=\"line\">&#125;</div><div class=\"line\">$(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</div><div class=\"line\">    $.ajax(&#123;</div><div class=\"line\">        url: <span class=\"string\">\"setJsonObject.action\"</span>,</div><div class=\"line\">\ttype: <span class=\"string\">'POST'</span>,</div><div class=\"line\">\tcache: <span class=\"literal\">false</span>,</div><div class=\"line\">\t<span class=\"keyword\">async</span>:<span class=\"literal\">false</span>,</div><div class=\"line\">\tdata: getRbJson(),</div><div class=\"line\">            success: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">text</span>) </span>&#123;</div><div class=\"line\">\t&#125;,</div><div class=\"line\">\terror: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">jqXHR, textStatus, errorThrown</span>) </span>&#123;</div><div class=\"line\">\t    alert(jqXHR.responseText);</div><div class=\"line\">\t&#125;</div><div class=\"line\">    &#125;);</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">☞ java片段：</div><div class=\"line\"><span class=\"keyword\">private</span> RbGoods rb;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> RbGoods <span class=\"title\">getRb</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> rb;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setRb</span><span class=\"params\">(RbGoods rb)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.rb = rb;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">setJsonObject</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    System.out.println(rb.getGoodsCd());</div><div class=\"line\">    <span class=\"keyword\">return</span> SUCCESS;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<ul>\n<li><strong>前后端：Json String–&gt;JavaBean：</strong></li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">☞ js片段：</div><div class=\"line\"><span class=\"keyword\">var</span> rbStr = &#123;&#125;;</div><div class=\"line\"><span class=\"keyword\">var</span> rbArray = [];</div><div class=\"line\">rbArray.push(&#123;goodsCd:<span class=\"string\">'1'</span>,goodsName:<span class=\"string\">'che'</span>&#125;);</div><div class=\"line\">rbArray.push(&#123;goodsCd:<span class=\"string\">'2'</span>,goodsName:<span class=\"string\">'chen'</span>&#125;);</div><div class=\"line\">rbStr[<span class=\"string\">\"jsonArrayStr\"</span>] = rbArray;</div><div class=\"line\">$.ajax(&#123;</div><div class=\"line\">       url: <span class=\"string\">\"jsonStrToObject.action\"</span>,</div><div class=\"line\">      type: <span class=\"string\">'POST'</span>,</div><div class=\"line\">     cache: <span class=\"literal\">false</span>,</div><div class=\"line\">       <span class=\"keyword\">async</span>:<span class=\"literal\">false</span>,</div><div class=\"line\">       data: &#123;jsonStr:<span class=\"built_in\">JSON</span>.stringify(rbArray)&#125;,</div><div class=\"line\">    success: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">text</span>) </span>&#123;&#125;,</div><div class=\"line\">   error: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">jqXHR, textStatus, errorThrown</span>) </span>&#123;</div><div class=\"line\">           alert(jqXHR.responseText);</div><div class=\"line\">       &#125;</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div></pre></td><td class=\"code\"><pre><div class=\"line\">☞ java片段：</div><div class=\"line\"><span class=\"keyword\">private</span> String jsonStr;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getJsonStr</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> jsonStr;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setJsonStr</span><span class=\"params\">(String jsonStr)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.jsonStr = jsonStr;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">jsonStrToObject</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">// String转JSON</span></div><div class=\"line\">    JSONArray jsonArray = JSONArray.fromObject(jsonStr);</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; jsonArray.size(); i++) &#123;</div><div class=\"line\">        <span class=\"comment\">// JSON转object对象</span></div><div class=\"line\">        String JOStr = jsonArray.getString(i);</div><div class=\"line\">        JSONObject JO = JSONObject.fromObject(JOStr);</div><div class=\"line\">        RbGoods goods =(RbGoods)JSONObject.toBean(JO, RbGoods.class);</div><div class=\"line\">        System.out.println(goods.getGoodsCd());</div><div class=\"line\">    &#125;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">return</span> SUCCESS;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\">function <span class=\"title\">newchePoint</span><span class=\"params\">(obj)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"&lt;che id=\\\"\"</span>+obj.id+</div><div class=\"line\">    <span class=\"string\">\"\\\" type=\\\"\"</span>+obj.type+<span class=\"string\">\"\\\" value=\\\"\\\"/&gt;\\r\\n\"</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<ul>\n<li><strong>更新ing…</strong></li>\n</ul>\n"},{"title":"link","url":"http://rebey.cn/link/index.html","content":""},{"title":"project","url":"http://rebey.cn/project/index.html","content":""},{"title":"tag","url":"http://rebey.cn/tag/index.html","content":""},{"title":"about","url":"http://rebey.cn/about/index.html","content":""},{"title":"search","url":"http://rebey.cn/search/index.html","content":""},{"title":"category","url":"http://rebey.cn/category/index.html","content":""}]